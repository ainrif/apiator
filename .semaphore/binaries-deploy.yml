version: v1.0
name: binaries-deploy
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Deploy
    task:
      prologue:
        commands:
          - checkout
          - sem-version java 11
          - sem-version node 8
          - nvm install v10.16.0
          - nvm use v10.16.0
          - 'alias gw=''./gradlew --console=plain --no-daemon'' '
      jobs:
        - name: Maven Central
          commands:
            - gw publish
            - gw publishPlugins -p ./gradle-plugin/apiator-gradle-plugin -Pgradle.publish.key=${GRADLE_PUBLISH_KEY} -Pgradle.publish.secret=${GRADLE_PUBLISH_SECRET}
            - gw publishGitTag
      secrets:
        - name: binaries-deploy
        - name: semaphoreci_id_rsa